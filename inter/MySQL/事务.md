事务是数据库的逻辑工作单位，是恢复和并发的基本单位，具有ACID特性。

## ACID

- 原子性（Atomicity）：对于事务中的所有操作，要么都做，要么都不做。

- 一致性（Consistency）：一致性是由由原子性保障的，因为事务处于成功提交的状态称为一致性状态，事务提交要么成功，要么失败回滚到上一个成功的状态。

- 隔离性（Isolation）：不同事务的内部操作及其使用的数据彼此隔离，互不干扰。

- 持续性（Durability）：事务一旦提交成功，它对数据库中的数据的改变是永久性的，接下来的其他操作和故障不会影响它的执行结果。

  展开：Checkpoint 和 二阶段提交

  特别地，有一种情况，就是内存缓冲数据与磁盘数据同步的时候，为了在提交事务时发生宕机导致数据丢失，需要先将 redo log buffer 同步到磁盘的 redo log file 中，然后在将出现差异的数据页刷新回磁盘。

## 隔离级别

- 脏读：事务A读取数据d，同时事务B修改了数据d，事务A能直接看到事务B对数据d的修改，但是如果事务B回滚，事务A看到的数据是脏数据，即不正确的数据。
- 不可重读读：事务A读取数据d，同时事务B修改了数据d，在事务B提交之前，事务A看不到事务B对数据d的修改。但是在事务B提交之后，事务A读取到的数据d的值与原来的不一致。
- 幻影读：事务A读取数据集d，事务B在d中增加或删除一些记录，事务A再次读取数据集d的时候，发现多了或者少了一些数据。

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（read-uncommitted） | 是   | 是         | 是   |
| 不可重复读（read-committed） | 否   | 是         | 是   |
| 可重复读（repeatable-read）  | 否   | 否         | 是   |
| 串行化（serializable）       | 否   | 否         | 否   |

- **读未提交（read-uncommitted）：** 事务A读取数据d，同时事务B修改了数据d，事务A能直接看到事务B对数据d的修改，但是如果事务B回滚，事务A看到的数据时脏数据，即不正确的数据。
- **不可重复读（read-committed）：** 使用行级锁，在该隔离级别下，比如说事务A读取数据d，同时事务B修改了数据d，在事务B提交之前，事务A看不到事务B对数据d的修改。但是在事务B提交之后，事务A读取到的数据d的值与原来的不一致，即不可重复读。
- **可重复读（repeatable-read）：** 如果检索条件有索引（包括主键索引）的时候，默认加锁方式是next-key锁；如果检索条件没有索引，更新数据时会锁住整张表。一个间隙被事务加了锁，其他事务是不能在这个间隙插入记录的，这样可以防止幻读。InnoDB默认的隔离级别。
- **串行化（serializable）：** 采用表级锁，并发性极低

**隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大**